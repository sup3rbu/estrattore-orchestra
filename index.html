<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estrattore al Minuto</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background-color: #eef2f3; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; }
        #numero-estratto { font-size: 5rem; font-weight: bold; color: #2ecc71; margin: 15px 0; min-height: 100px; }
        button { padding: 12px 25px; font-size: 1rem; cursor: pointer; background-color: #3498db; color: white; border: none; border-radius: 8px; font-weight: bold; width: 100%; }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; }
        .info { margin-top: 20px; font-size: 0.9rem; color: #7f8c8d; }
        .lista-rimanenti { margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; }
        #numeri-lista { font-weight: bold; color: #34495e; word-wrap: break-word; }
    </style>
</head>
<body>

    <div class="card">
        <h2 id="titolo">Estrai un numero</h2>
        <div id="numero-estratto">--</div>
        <button id="btn-estrai" onclick="estraiNumero()">ESTRAI ORA</button>
        
        <p id="messaggio" class="info"></p>

        <div class="lista-rimanenti">
            <p>Numeri ancora disponibili:</p>
            <div id="numeri-lista"></div>
        </div>
    </div>

    <script>
        // La tua lista iniziale
        let listaNumeri = [10, 25, 42, 7, 99, 13, 88, 54, 21, 33];

        const displayNumero = document.getElementById('numero-estratto');
        const btnEstrai = document.getElementById('btn-estrai');
        const messaggio = document.getElementById('messaggio');
        const displayLista = document.getElementById('numeri-lista');

        function aggiornaInterfaccia() {
            const ultimoMinuto = localStorage.getItem('ultimoMinuto');
            const numeroSalvato = localStorage.getItem('numeroSalvato');
            
            // Creiamo una stringa univoca per il minuto corrente (es: "2026-02-04-16:45")
            const oraAttuale = new Date();
            const IDMinutoCorrente = `${oraAttuale.getFullYear()}-${oraAttuale.getMonth()}-${oraAttuale.getDate()}-${oraAttuale.getHours()}:${oraAttuale.getMinutes()}`;

            // Recupera lista aggiornata dal storage o usa quella base
            const listaSalvata = JSON.parse(localStorage.getItem('listaRimanente'));
            if (listaSalvata) listaNumeri = listaSalvata;

            displayLista.innerText = listaNumeri.join(", ");

            if (ultimoMinuto === IDMinutoCorrente) {
                displayNumero.innerText = numeroSalvato;
                btnEstrai.disabled = true;
                messaggio.innerText = "Hai già estratto per questo minuto. Attendi il prossimo!";
            } else {
                if (listaNumeri.length === 0) {
                    btnEstrai.disabled = true;
                    messaggio.innerText = "Lista esaurita!";
                } else {
                    btnEstrai.disabled = false;
                    messaggio.innerText = "Puoi estrarre un nuovo numero!";
                }
            }
        }

        function estraiNumero() {
            if (listaNumeri.length === 0) return;

            const oraAttuale = new Date();
            const IDMinutoCorrente = `${oraAttuale.getFullYear()}-${oraAttuale.getMonth()}-${oraAttuale.getDate()}-${oraAttuale.getHours()}:${oraAttuale.getMinutes()}`;
            
            // Estrazione
            const indice = Math.floor(Math.random() * listaNumeri.length);
            const estratto = listaNumeri.splice(indice, 1)[0];

            // Salvataggio
            localStorage.setItem('ultimoMinuto', IDMinutoCorrente);
            localStorage.setItem('numeroSalvato', estratto);
            localStorage.setItem('listaRimanente', JSON.stringify(listaNumeri));

            displayNumero.innerText = estratto;
            aggiornaInterfaccia();
        }

        // Controlla ogni 5 secondi se è scattato il nuovo minuto per riattivare il bottone automaticamente
        setInterval(aggiornaInterfaccia, 5000);
        
        // Primo avvio
        aggiornaInterfaccia();
    </script>
</body>
</html>
