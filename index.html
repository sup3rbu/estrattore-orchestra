<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Lotto 5s</title>
    <style>
        :root {
            --primary: #6366f1;
            --accent: #f59e0b;
            --bg: #f1f5f9;
            --card: #ffffff;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; }
        
        /* Display Principale */
        .slot-machine { height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 10px 0; overflow: hidden; }
        #numero-estratto { font-size: 4rem; font-weight: 800; color: var(--primary); margin: 0; line-height: 1; }
        #nome-estratto { font-size: 1.2rem; color: var(--accent); font-weight: 600; min-height: 1.5em; }
        
        /* Animazione Rullata */
        .rolling { animation: shake 0.1s infinite; color: #cbd5e1 !important; }
        @keyframes shake {
            0% { transform: translateY(-5px); }
            100% { transform: translateY(5px); }
        }

        button { width: 100%; padding: 15px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; background: var(--primary); color: white; transition: 0.2s; box-shadow: 0 4px 0 #4338ca; }
        button:active { transform: translateY(3px); box-shadow: none; }
        button:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; }
        
        #messaggio { font-size: 0.85rem; margin: 15px 0; color: #64748b; height: 1em; }

        /* Griglie */
        .section-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: #94a3b8; margin: 25px 0 10px; text-align: left; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }
        .grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; }
        
        /* Badge Numero */
        .box { padding: 5px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; background: #f8fafc; border: 1px solid #e2e8f0; color: #475569; }
        .box-estratto { background: #fff7ed; border-color: #ffedd5; color: #9a3412; display: flex; flex-direction: column; align-items: center; min-width: 60px; }
        .box-estratto span { font-size: 0.6rem; font-weight: 400; color: #c2410c; }
    </style>
</head>
<body>

    <div class="container">
        <h2 style="margin:0; color:#1e293b;">Disney Extractions</h2>
        
        <div class="slot-machine">
            <p id="numero-estratto">--</p>
            <p id="nome-estratto">Scegli un personaggio</p>
        </div>
        
        <button id="btn-estrai" onclick="avviaEstrazione()">GIOCA ORA</button>
        <p id="messaggio"></p>

        <div class="section-title">‚ú® Gi√† Estratti (Numero + Nome)</div>
        <div id="lista-estratti" class="grid"></div>

        <div class="section-title">üó≥Ô∏è Ancora nel sacco (Solo Numeri)</div>
        <div id="lista-rimanenti" class="grid"></div>
    </div>

    <script>
        const DATABASE = {
            1: "Topolino", 2: "Paperino", 3: "Pippo", 4: "Pluto", 5: "Minnie",
            6: "Paperina", 7: "Zio Paperone", 8: "Simba", 9: "Aladdin", 10: "Bambi",
            11: "Cenerentola", 12: "Mulan", 13: "Hercules", 14: "Tarzan", 15: "Stitch"
        };

        const ATTESA_MS = 5000;

        function init() {
            if (!localStorage.getItem('rimanenti_disney')) {
                localStorage.setItem('rimanenti_disney', JSON.stringify(Object.keys(DATABASE).map(Number)));
                localStorage.setItem('estratti_disney', JSON.stringify([]));
            }
            aggiornaUI();
        }

        function aggiornaUI() {
            const rimanenti = JSON.parse(localStorage.getItem('rimanenti_disney')).sort((a,b) => a-b);
            const estratti = JSON.parse(localStorage.getItem('estratti_disney')).sort((a,b) => a-b);
            const ultima = parseInt(localStorage.getItem('ts_disney')) || 0;
            const ultimoID = localStorage.getItem('ultimo_id');

            // Update numero principale
            if(ultimoID) {
                document.getElementById('numero-estratto').innerText = ultimoID;
                document.getElementById('nome-estratto').innerText = DATABASE[ultimoID];
            }

            // Lista Rimanenti (Solo Numeri)
            document.getElementById('lista-rimanenti').innerHTML = rimanenti
                .map(n => `<div class="box">${n}</div>`).join('');

            // Lista Estratti (Numero + Nome)
            document.getElementById('lista-estratti').innerHTML = estratti
                .map(n => `<div class="box box-estratto">${n}<span>${DATABASE[n]}</span></div>`).join('');

            // Timer
            const mancano = Math.max(0, Math.ceil((ultima + ATTESA_MS - Date.now()) / 1000));
            const btn = document.getElementById('btn-estrai');
            const msg = document.getElementById('messaggio');

            if (rimanenti.length === 0 && !localStorage.getItem('is_rolling')) {
                btn.disabled = true;
                msg.innerText = "Cast completo! Tutti i personaggi sono usciti.";
            } else if (mancano > 0) {
                btn.disabled = true;
                msg.innerText = `Prossimo tour tra ${mancano}s...`;
                setTimeout(aggiornaUI, 1000);
            } else {
                btn.disabled = false;
                msg.innerText = "Pronto per l'estrazione!";
            }
        }

        function avviaEstrazione() {
            const btn = document.getElementById('btn-estrai');
            const numDisplay = document.getElementById('numero-estratto');
            const nomeDisplay = document.getElementById('nome-estratto');
            
            btn.disabled = true;
            localStorage.setItem('is_rolling', 'true');
            numDisplay.classList.add('rolling');
            nomeDisplay.innerText = "Estrazione in corso...";

            // Effetto "Finta rullata"
            let giri = 0;
            const intervallo = setInterval(() => {
                numDisplay.innerText = Math.floor(Math.random() * 99);
                giri++;
                if (giri > 10) {
                    clearInterval(intervallo);
                    eseguiEstrazioneReale();
                }
            }, 100);
        }

        function eseguiEstrazioneReale() {
            let rimanenti = JSON.parse(localStorage.getItem('rimanenti_disney'));
            let estratti = JSON.parse(localStorage.getItem('estratti_disney'));
            const numDisplay = document.getElementById('numero-estratto');

            const indice = Math.floor(Math.random() * rimanenti.length);
            const scelto = rimanenti.splice(indice, 1)[0];
            estratti.push(scelto);

            localStorage.setItem('rimanenti_disney', JSON.stringify(rimanenti));
            localStorage.setItem('estratti_disney', JSON.stringify(estratti));
            localStorage.setItem('ts_disney', Date.now());
            localStorage.setItem('ultimo_id', scelto);
            localStorage.removeItem('is_rolling');

            numDisplay.classList.remove('rolling');
            aggiornaUI();
        }

        init();
    </script>
</body>
</html>
